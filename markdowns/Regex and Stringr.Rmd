---
title: "Regex Explained"
output: html_document
---

A (very) important part of natural language processing is searching for patterns of characters. While this may seem like a somewhat boring part of the process, it is usually the first task in cleaning and preparing data for natural language processing. 

In this tutorial, we will go through how regex is used in R and specifically in the `tidyverse` via the `stringr` package. 

To get started, lets load in the `stringr` package as well as some data. We will be working with *Heart of Darkness* by Joseph Conrad. Let's start by working with the first four lines of book (which make up the first two sentences). 

```{r warning=FALSE, message=FALSE}

library(stringr)
library(dplyr)
library(gutenbergr)

# download heart of darkness
hod = gutenberg_download("219") 
# pull the first two lines of the book and collapse them into a single character vector
start = hod[11:14, 2]
start
```

## Pattern Matching with Regex

Now that we have our sentence, let's go over the building blocks of regex. We will be using the `str_match()` function to pull out our patterns. Throughout this tutorial, we will be combining `stringr` functions with `mutate()` to create new variables. 

Lets start with something simple and create a new variable called "match" that has all the matches for our the pattern "flutter". That is to say, if the text contains the pattern, it will return the pattern, and if it doesn't it will return a NA.

```{r warning=FALSE, message=FALSE}
# if the word flutter wasn't in here 
start%>%
  mutate(match = str_match(text, "flutter"))

```

Ok seems simple enough. The complexity comes in when we start dealing with special characters. What makes regex regex is that you use different characters to describe patterns. For example the . means any character. What do we think will happen if we replace flutter with the ".".
```{r warning=FALSE, message=FALSE}
# if the word flutter wasn't in here 
start%>%
  mutate(match = str_match(text, "."))

```

As we can see, it pulls back the first character from each line. It only pulls back one character because it returns the *first* match of the pattern. To pull back all matches, use `str_match_all()`.

### String Literals
This naturally leads to the question of how do you match a period. You use the escape character which is a backward slash `\`. This will tell regex to interpret the next character as a "literal". In R, you have to double escape or write: `\\`.

If we had the pattern of `....\\.` what do we think we would get?

```{r warning=FALSE, message=FALSE}
# if the word flutter wasn't in here 
start%>%
  mutate(match = str_match(text, "....\\."))

```

Only two of the lines have a matching pattern because only two of the lines have a period in them. Both of the words before the period happen to be four letter words, which is convenient because the first four periods in the `....\\.` pattern will return any character, and in this case all the characters happened to be letters (if it was a three letter word it would have returned a space).

## Matching Specific Characters

While Heart of Darkness is an interesting book, next we are going to work a more targeted dataset. This may be a little more abstract and unlike data you might see in the wild but will better illustrate how the pattern matching works! First lets create our data.

```{r warning=FALSE, message = FALSE}

text = data.frame(
  characters = c("can", "man", "fan", "ran", "tan")
)

```

Now lets match just can, man, and fan on this set. We can use the `[]` to match specific characters. Think of it like an OR statement. `[abc]` will be a, b or c. So how could we apply this to match just can, man, and fan? 

```{r warning=FALSE, message=FALSE}
# if the word flutter wasn't in here 
text%>%
  mutate(match = str_match(characters, "[cmf]an"))

```

What about characters that we don't want included? While there are only three characters that we would place inside our square brackets this time, what if we wanted to include all characters except just one or two? We would use the `^` operator then. Just put it at the beginning of your square brackets!

```{r warning=FALSE, message=FALSE}
# if the word flutter wasn't in here 
text%>%
  mutate(match = str_match(characters, "[^rt]an"))

```