---
title: "Introduction to Sentiment Analysis"
author: "Team Hanley NLP Working Group"
output:
  html_document:
    toc: TRUE
    toc_depth: 2
    self_contained: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Sentiment Analysis


Sentiment analysis is the classification and analysis of the emotional intent in text data. Some approaches include classifying words as positive or negative, assigning words to a specific emotion (like surprise), or calculating a sentiment score in the form of a number.  


`tidytext` has several sentiment lexicons that help in such analysis. To start, we'll take a look at "afinn", "bing", and "nrc".  

"afinn" assigns a number score, with higher numbers being more positive.


```{r warning=FALSE, message=FALSE}

library(tidytext)

get_sentiments("afinn")

```



"bing" classifies words as either positive or negative.



```{r warning=FALSE, message=FALSE}

get_sentiments("bing")

```



And "nrc" assigns words as either "yes" or "no" under categories of positive, negative, anger, anticipation, disgust, fear, joy, sadness, surprise, and trust.



```{r warning=FALSE, message=FALSE}

get_sentiments("nrc")

```



Let's look at some Tom Cruise tweets and see how we can apply sentiment analysis through wordclouds. We'll start by pulling in our tweets and cleaning up our text.



```{r warning=FALSE, message=FALSE}


library(wordcloud)
library(RColorBrewer)
library(dplyr)
library(rtweet)
library(tm)
source("../keys.R")

twitter_token <- create_token(
  app = twitter_app,
  consumer_key = twitter_api_key,
  consumer_secret = twitter_api_secret_key,
  access_token = twitter_access_token,
  access_secret = twitter_access_token_secret
)

tomcruise = get_timeline("@TomCruise", n =500)

text = tomcruise %>% select(text)%>%
  mutate(text = gsub(" ?(f|ht)(tp)(s?)(://)(.*)[.|/](.*)", "", tomcruise$text),
         linenumber = row_number())



```



Now we'll make a wordcloud for positive words in these tweets, as assigned using the "bing" sentiment lexicon.



```{r warning=FALSE, message=FALSE}


sentiment = text%>% #this allows us to retain the row number/the tweet
  unnest_tokens(word, text)%>% # this unnests the tweets into words
  anti_join(stop_words)%>% #removes common words (stop words)
  left_join(get_sentiments("bing"))


positive_sentiment = sentiment%>% filter(!is.na(sentiment),
         sentiment == 'positive') # gets sentiment score based on bing dictionary

wordcloud(positive_sentiment$word, random.order = FALSE, colors=brewer.pal(6, "Dark2"))


```



And the negative words...



```{r warning=FALSE, message=FALSE}


negative_sentiment = sentiment%>% filter(!is.na(sentiment),
         sentiment == 'negative') # gets sentiment score based on bing dictionary

wordcloud(negative_sentiment$word, random.order = FALSE, colors=brewer.pal(6, "Dark2"))


```



Next, let's explore the "nrc" lexicon by creating a radar chart.


```{r warning=FALSE, message=FALSE}

library(fmsb)
library(tidyr)

nrc_sentiment = text%>% #this allows us to retain the row number/the tweet
  unnest_tokens(word, text)%>% # this unnests the tweets into words
  anti_join(stop_words)%>% #removes common words (stop words)
  left_join(get_sentiments("nrc"))%>%
  filter(!is.na(sentiment))

nrc_sentiment = nrc_sentiment%>%
  group_by(sentiment)%>%
  summarise(count = n())%>%
  spread(sentiment, count)

nrc_sentiment <- rbind(rep(400,10) , rep(0,10), nrc_sentiment)


radarchart(nrc_sentiment, axistype=1 , 
    pcol=rgb(0.2,0.5,0.5,0.9) , pfcol=rgb(0.2,0.5,0.5,0.5) , plwd=4 , 
    cglcol="grey", cglty=1, axislabcol="grey", caxislabels=seq(0,20,5), cglwd=0.8,
    vlcex=0.8 )


```



Let's finish by returning to the "bing" lexicon and make a chart representing the change in sentiments throughout the course of Franz Kafka's Metamorphosis. 



```{r warning=FALSE, message=FALSE}

library(gutenbergr)
library(tidyr)
library(ggplot2)

meta = gutenberg_download("5200")

meta$chapter = NA
meta$chapter[1:639] = 1
meta$chapter[640:1295] = 2
meta$chapter[1296:nrow(meta)] = 3

book_words <- meta%>%
  mutate(linenumber = row_number())%>%
  unnest_tokens(word, text)

book_words <- distinct(book_words)

sentbars = book_words %>%
  inner_join(get_sentiments("bing"))%>%
  mutate(index = linenumber %/% 25)%>%
  group_by(index, sentiment)%>%
  summarise(count = n())%>%
  spread(sentiment, count, fill = 0) %>%
  mutate(sentiment = positive - negative,
         sentiment_group = ifelse(sentiment > 0, "pos", "neg"))

ggplot(data = sentbars) +
  geom_bar(aes(x = index, y = sentiment, fill = sentiment_group), stat = "identity")+
  theme_classic()+
  theme(
    legend.position = "none"
  )+
  scale_fill_manual(values = c("darkred", "darkgreen"))+
  labs(title = "The Metamorphosis of Sentiment",
       x = "Each Bar is 25 Lines",
       y = "Sentiment Score")


```



